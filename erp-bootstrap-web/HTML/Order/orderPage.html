<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>订单条件查询</title>
    <link href="../../bootstrap-4.6.2-dist/css/bootstrap.css" rel="stylesheet">
    <link href="../../bootstrap-4.6.2-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../bootstrap-4.6.2-dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="../../myCSS/all.css" rel="stylesheet">
    <style>
        .clearfix::after {
            content: "";
            display: table;
            clear: both;
            /* 设置背景颜色并加上透明度 */
            /* 替换为你需要的颜色值和透明度 */
        }

        .center-nav {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="jumbotron top-main-container">
        <h1 class="display-4">订单分页查询</h1>
        <p class="lead">请通过下面的条件进行订单查询！</p>
        <hr class="my-4">
        <a class="btn btn-primary btn-lg" href="../home.html" role="button">返回主页</a>
    </div>
    <form class="query-form">
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputCustomerName">客户名称</label>
                <input class="form-control" id="inputCustomerName" placeholder="(模糊查询)" type="text">
            </div>
            <div class="form-group col-md-4">
                <label for="inputShipperName">运货商名称</label>
                <input class="form-control" id="inputShipperName" placeholder="(模糊查询)" type="text">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputShipProvince">收货省份</label>
                <input class="form-control" id="inputShipProvince" placeholder="(模糊查询)" type="text">
            </div>
            <div class="form-group col-md-4">
                <label for="inputShipCity">收货城市</label>
                <input class="form-control" id="inputShipCity" placeholder="(模糊查询)" type="text">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputShipRegion">收货地区</label>
                <select class="form-control" id="inputShipRegion">
                    <option value="">请选择地区</option>
                    <option value="东北">东北</option>
                    <option value="华北">华北</option>
                    <option value="华东">华东</option>
                    <option value="华南">华南</option>
                    <option value="华中">华中</option>
                    <option value="西北">西北</option>
                    <option value="西南">西南</option>
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="inputEmployeeName">跟单业务员姓名</label>
                <input class="form-control" id="inputEmployeeName" placeholder="(模糊查询)" type="text">
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputStartOrderDate">下单时间(起始时间)</label>
                <input class="form-control datepicker" id="inputStartOrderDate" placeholder="选择起始时间" type="text">
            </div>
            <div class="form-group col-md-4">
                <label for="inputEndOrderDate">下单时间(截止时间)</label>
                <input class="form-control datepicker" id="inputEndOrderDate" placeholder="选择截止时间" type="text">
            </div>
        </div>
        <button class="btn btn-primary" type="submit">查询</button>
    </form>
    <hr>
    <!-- 查询结果 -->
    <div class="clearfix" id="orderListContainer" style="height: 60%;">
        <ul class="list-unstyled" id="orderList">
            <!-- 产品列表项将会动态添加到这里 -->
        </ul>
    </div>
    <hr>
    <!-- 导航栏 -->
    <div class="clearfix center-nav" id="paginationContainer" style="height: 4%;">
        <nav aria-label="Page navigation example">
            <ul class="pagination" id="pagination">
                <!-- 导航栏按钮将会动态添加到这里 -->
            </ul>
        </nav>
    </div>

</div>

<script src="../../bootstrap-4.6.2-dist/js/jquery-3.7.1.js"></script>
<script src="../../bootstrap-4.6.2-dist/js/bootstrap.bundle.min.js"></script>
<script src="../../bootstrap-4.6.2-dist/js/bootstrap.bundle.js"></script>
<script src="../../bootstrap-4.6.2-dist/js/bootstrap.js"></script>
<script src="../../bootstrap-4.6.2-dist/js/bootstrap-datepicker.min.js"></script>
<script>
    // 更新产品列表
    function updateProductList(data) {
        var orderList = $("#orderList");

        // 清空现有的列表内容
        orderList.empty();

        // 遍历返回的数据，动态生成列表项
        for (var i = 0; i < data.length; i++) {
            var order = data[i];

            // 创建列表项
            var listItem = $("<li class='media-lg'>");
            // 添加文字列
            listItem.append("<div class='col-10 media-body'>");
            listItem.append("<p>订单编号: " + order.id + "</p>");
            listItem.append("<p>客户编号: " + order.customerId + " 客户: " + order.customerName + " 客户联系人: " + order.customerContact + " 联系电话: " + order.customerPhone + "</p>");
            listItem.append("<p>下单时间: " + order.orderDate + " 发货时间: " + order.shipDate + " 收货时间: " + order.arrivalDate + " 收件人: " + order.contact + " 收货地址: " + order.shipAddress + " </p>");
            listItem.append("<p>跟单业务员工号: " + order.employeeId + " 跟单业务员: " + order.employeeName + " 联系电话: " + order.employeePhone + "</p>");
            listItem.append("<p>运货商编号: " + order.shipperId + " 运货商: " + order.shipperName + " 运费: " + order.freight + "元 联系电话: " + order.shipperPhone + "</p>");
            listItem.append("<hr>");
            listItem.append("</div>");

            // 将列表项添加到产品列表
            orderList.append(listItem);
        }
    }

    // 更新导航栏
    function updatePagination(pageNumber, totalPage) {
        var pagination = $("#pagination");

        // 清空现有的导航栏内容
        pagination.empty();

        // 添加上一页按钮
        if (pageNumber > 1) {
            pagination.append("<li class='page-item' id='prevPage'><a class='page-link' href='#' aria-label='Previous'><span aria-hidden='true'>&laquo;</span></a></li>");
        } else {
            pagination.append("<li class='page-item disabled'><span class='page-link' aria-hidden='true'>&laquo;</span></li>");
        }
        // 添加当前页按钮
        pagination.append("<li class='page-item active'><a class='page-link' href='#'>" + pageNumber + "</a></li>");

        // 添加下一页按钮
        if (pageNumber < totalPage) {
            pagination.append("<li class='page-item' id='nextPage'><a class='page-link' href='#' aria-label='Next'><span aria-hidden='true'>&raquo;</span></a></li>");
        } else {
            pagination.append("<li class='page-item disabled'><span class='page-link' aria-hidden='true'>&raquo;</span></li>");
        }
        // 绑定上一页和下一页按钮的点击事件
        $("#prevPage").click(function () {
            handlePageChange(pageNumber - 1);
        });

        $("#nextPage").click(function () {
            handlePageChange(pageNumber + 1);
        });
        // 绑定页码按钮的点击事件
        bindPageClickEvent(totalPage);
    }

    // 处理页面变化逻辑
    function handlePageChange(newPage) {
        // 在这里处理页面变化的逻辑
        fetchDataAndRender(newPage);
    }

    // 绑定页码按钮的点击事件
    function bindPageClickEvent(totalPage) {
        // 为每个页码按钮添加点击事件
        for (var i = 1; i <= totalPage; i++) {
            $("#page" + i).click(function () {
                // 在这里处理点击页码按钮的逻辑
                var clickedPage = $(this).text();  // 获取点击的页码
                fetchDataAndRender(clickedPage);
            });
        }
    }

    // 发起POST请求并更新页面
    function fetchDataAndRender(pageNumber) {
        var CustomerName = $("#inputCustomerName").val();
        var ShipperName = $("#inputShipperName").val();
        var ShipProvince = $("#inputShipProvince").val();
        var ShipCity = $("#inputShipCity").val();
        var ShipRegion = $("#inputShipRegion").val();
        var EmployeeName = $("#inputEmployeeName").val();
        var StartOrderDate = $("#inputStartOrderDate").val();
        var EndOrderDate = $("#inputEndOrderDate").val();

        var requestData = {
            customerName: CustomerName,
            shipperName: ShipperName,
            shipProvince: ShipProvince,
            shipCity: ShipCity,
            shipRegion: ShipRegion,
            employeeName: EmployeeName,
            startDate: StartOrderDate,
            endDate: EndOrderDate,
            pageNumber: pageNumber  // 添加页码信息
        };

        $.ajax({
            type: "POST",
            url: "http://localhost:8080/api/v1/orders",
            contentType: "application/json",
            data: JSON.stringify(requestData),
            success: function (response) {
                console.log("成功响应:", response);

                // 更新产品列表和导航栏
                updateProductList(response.data);
                updatePagination(response.pageNumber, response.totalPage);
            },
            error: function (error) {
                console.error("错误响应:", error);
            }
        });
    }

    // 在文档加载完成后调用，发起POST请求并更新页面
    $(document).ready(function () {
        // 监听表单提交事件
        $("form").submit(function (event) {
            // 阻止表单默认提交行为
            event.preventDefault();

            // 获取表单中的各个输入字段的值
            var CustomerName = $("#inputCustomerName").val();
            var ShipperName = $("#inputShipperName").val();
            var ShipProvince = $("#inputShipProvince").val();
            var ShipCity = $("#inputShipCity").val();
            var ShipRegion = $("#inputShipRegion").val();
            var EmployeeName = $("#inputEmployeeName").val();
            var StartOrderDateInput = $("#inputStartOrderDate");
            var EndOrderDateInput = $("#inputEndOrderDate");
            if (!compareDates(StartOrderDateInput,EndOrderDateInput)) {
                return;
            }
            var StartOrderDate = StartOrderDateInput.val();
            var EndOrderDate = EndOrderDateInput.val();
            // 检查是否只存在一个时间
            if (!StartOrderDate && EndOrderDate) {
                StartOrderDateInput.datepicker('setDate', new Date('2019-01-01'));
                StartOrderDate = StartOrderDateInput.val();
            }
            if (StartOrderDate && !EndOrderDate) {
                EndOrderDateInput.datepicker('setDate', new Date());
                EndOrderDate = EndOrderDateInput.val();
            }

            var requestData = {
                customerName: CustomerName,
                shipperName: ShipperName,
                shipProvince: ShipProvince,
                shipCity: ShipCity,
                shipRegion: ShipRegion,
                employeeName: EmployeeName,
                startDate: StartOrderDate,
                endDate: EndOrderDate
            };

            // 发起POST请求
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/v1/orders",
                contentType: "application/json",
                data: JSON.stringify(requestData),
                success: function (response) {
                    // 处理成功响应
                    console.log("成功响应:", response);

                    // 更新产品列表和导航栏
                    updateProductList(response.data);
                    updatePagination(response.pageNumber, response.totalPage);
                },
                error: function (error) {
                    // 处理错误响应
                    console.error("错误响应:", error);
                }
            });
        });
    });

    $(document).ready(function () {
        // 初始化日期选择器
        $('.datepicker').datepicker({
            format: 'yyyy-mm-dd 00:00:00', // 日期格式
            autoclose: true,      // 选择日期后自动关闭日期选择器
            todayHighlight: true  // 高亮显示当前日期
        });

        // 获取起始时间和截止时间的输入框元素
        var startOrderDateInput = $('#inputStartOrderDate');
        var endOrderDateInput = $('#inputEndOrderDate');

        // 添加事件监听器
        startOrderDateInput.on('changeDate', function () {
            compareDates(startOrderDateInput,endOrderDateInput);
        });

        endOrderDateInput.on('changeDate', function () {
            compareDates(startOrderDateInput,endOrderDateInput);
        });
    });

    function compareDates(startOrderDateInput,endOrderDateInput) {
        // 获取起始时间和截止时间的日期值
        var startOrderDate = startOrderDateInput.datepicker('getDate');
        var endOrderDate = endOrderDateInput.datepicker('getDate');
        var currentDate = new Date();
        var limitDate = new Date('2019-01-01');
        if (startOrderDate && (startOrderDate < limitDate || startOrderDate > currentDate)) {
            alert('起始时间必须在2019-01-01到当前日期之间！');
            startOrderDateInput.val('');
            return false;
        }

        if (endOrderDate && (endOrderDate < limitDate || endOrderDate > currentDate)) {
            alert('截止时间必须在2019-01-01到当前日期之间！');
            endOrderDateInput.val('');
            return false;
        }

        if (startOrderDate && endOrderDate && startOrderDate > endOrderDate) {
            alert('起始时间不能晚于截止时间！');
            startOrderDateInput.val('');
            endOrderDateInput.val('');
            return false;
        }
        return true;
    }
</script>


</body>
</html>